/**
 * 工艺符号
 */
(function () {
    'use strict';

    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');

    var getProcessSymbalCfg = function (editor) {
        return editor.getParam('processSymbalCfg', {}, 'object');
    };
    var isSymbolImage = function (elm, type) {
        var t = elm.getAttribute('title');
        return elm.nodeName === 'IMG' && t && t.indexOf(type) == 0;
    };
    var open = function (editor, cfg) {
        var symbolCfg = getProcessSymbalCfg(editor) || {};
        var interValSplitter = symbolCfg.interValSplitter || '┇';
        var node = editor.selection.getNode();
        var dialog = editor.windowManager.openUrl({
            title: cfg.title,
            url: (symbolCfg.htmlPath || editor.baseURI.path) + '/plugins/processsymbol/' + cfg.page,
            width: cfg.width,
            height: cfg.height,
            onAction: function (api, detail) {
                api.iframe.contentWindow.getImgHtml(function (img) {
                    ed.execCommand('mceInsertContent', true, img);
                    api.close();
                });
            },
            buttons: [{
                type: 'custom',
                name: 'ok',
                text: '确定',
                primary: true
            }, {
                type: 'cancel',
                name: 'close',
                text: 'Close',
                primary: true
            }]
        });

        tinymce.dom.DomQuery('iframe').each(function (idx, dom) {
            if (dom.src && dom.src.indexOf(cfg.page) > 0) {
                dialog.iframe = dom;
                dom.contentWindow.symbolCfg = symbolCfg;
                if (node && isSymbolImage(node, cfg.symbol.cmdName + interValSplitter)) {
                    cfg.symbol.value = node.title;
                } else {
                    cfg.symbol.value = null;
                }
                dom.contentWindow.currentSymbol = cfg.symbol;
                return false;
            }
        })
        //dialog.sendMessage(getProcessSymbalCfg(editor));
    };

    var registerIcons = function (editor) {
        //editor.ui.registry.addIcon
        var icons = tinymce.IconManager.get('default').icons;
        icons.surfacenesssymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">  <image id="image0" width="20" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAQAAAAngNWGAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN\n' +
            'RQflBwYANy3Izl8cAAAAn0lEQVQoz63SwRXCIAyA4T8uwAgu4HtxA0foDj7vjtARPHWOukFH6AiO\n' +
            'wAAe4kHra2iLOQiXwPsgEBAj1nZB9xuKigagJO4cAbBqp2X4RFWmGBqBI+03rqYdZ6NNtidzKuCG\n' +
            'vbmFBomBVOx35eHnpts5SvJpZ1k9padfnNkWlIZcHsXd401JZJqVKlhJu+nRKtDgzJNDBCqX9aLK\n' +
            '33/4C0JP/kjREo+bAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTA1VDE2OjU1OjQ1KzA4OjAw\n' +
            'koEEcAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0wNVQxNjo1NTo0NSswODowMOPcvMwAAAAg\n' +
            'dEVYdHNvZnR3YXJlAGh0dHBzOi8vaW1hZ2VtYWdpY2sub3JnvM8dnQAAABh0RVh0VGh1bWI6OkRv\n' +
            'Y3VtZW50OjpQYWdlcwAxp/+7LwAAABd0RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMjDf4aiZAAAA\n' +
            'FnRFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADIwJ05oFAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGlt\n' +
            'YWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNjI1NDc1MzQ1Gj22XwAAABF0RVh0VGh1\n' +
            'bWI6OlNpemUAMTgxQkJHu5VsAAAARXRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vYXBwL3RtcC9pbWFn\n' +
            'ZWxjL2ltZ3ZpZXcyXzlfMTYyMzkxMjA3NjU2NDIwMzFfN19bMF1C4XKsAAAAAElFTkSuQmCC" ></image>\n' +
            '</svg>';
        icons.tolerancessymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">  <image id="image0" width="20" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAQAAAAngNWGAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN\n' +
            'RQflBwYBDB89aYuTAAAAj0lEQVQoz9WQMQ6DQAwEZ9FJpEzFh/KCVCh1npBPReIxvIOOGilsCgTk\n' +
            'kO6goIm38Nka6+yVORbFQe4vQByJdtOY1BrF9sjWb167YX7u/RyWFZQfCJu6n9FopF/qeKeEPXrJ\n' +
            'IMt6pkEZVZR0XCnpPOTAQM3AyIUmDU423zHmZtKSARU8+PidO2bf6fXqk8Ev+2dL43VZnRMAAAAl\n' +
            'dEVYdGRhdGU6Y3JlYXRlADIwMjEtMDctMDVUMTc6MTI6MzErMDg6MDDjmJgEAAAAJXRFWHRkYXRl\n' +
            'Om1vZGlmeQAyMDIxLTA3LTA1VDE3OjEyOjMxKzA4OjAwksUguAAAACB0RVh0c29mdHdhcmUAaHR0\n' +
            'cHM6Ly9pbWFnZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn\n' +
            '/7svAAAAF3RFWHRUaHVtYjo6SW1hZ2U6OkhlaWdodAAyMN/hqJkAAAAWdEVYdFRodW1iOjpJbWFn\n' +
            'ZTo6V2lkdGgAMjAnTmgUAAAAGXRFWHRUaHVtYjo6TWltZXR5cGUAaW1hZ2UvcG5nP7JWTgAAABd0\n' +
            'RVh0VGh1bWI6Ok1UaW1lADE2MjU0NzYzNTEW/uzpAAAAEXRFWHRUaHVtYjo6U2l6ZQAxNTBCQrQT\n' +
            'J4YAAABGdEVYdFRodW1iOjpVUkkAZmlsZTovLy9hcHAvdG1wL2ltYWdlbGMvaW1ndmlldzJfOV8x\n' +
            'NjIzOTEyMTY2NjE3NTk2OF85OF9bMF3N5WuoAAAAAElFTkSuQmCC" ></image>\n' +
            '</svg>';
        icons.markedsymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">  <image id="image0" width="20" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAAAAACo4kLRAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN\n' +
            'RQflBwYBDTsYcV4DAAABAklEQVQY06WQv0oDQRDGz2ATwRi0EivtA76LVmJn6wtooUWaYJfn8BHE\n' +
            'WtAiCIIE/6CIooln/tzFbG7v5ufs7WJh68Iys998M/N9GzEhseiZkWJnLiMyZEZjPCbTIB7E6GOA\n' +
            'u/kQcg9OSYRxjAzJEspJ0Tf0XOIoBR+hXQro0zlcnqvuX+naEnRbON1sdnht1c8D02rjy8aZcox9\n' +
            'rD95MLWkB03V4qpHu0GnTly/GalMO5XnxRIsnJV51VD0UU8LoV05jet3FTgQuith+xeyfQIm13pr\n' +
            'pwTVZGI/q/eCxNzWHjxzJOrmYun4jm67cum9i5Tf87a3Wlnb6k34dfT3/BP8AazzbJhbJ9k/AAAA\n' +
            'JXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTA1VDE3OjEzOjU5KzA4OjAw+dq02gAAACV0RVh0ZGF0\n' +
            'ZTptb2RpZnkAMjAyMS0wNy0wNVQxNzoxMzo1OSswODowMIiHDGYAAAAgdEVYdHNvZnR3YXJlAGh0\n' +
            'dHBzOi8vaW1hZ2VtYWdpY2sub3JnvM8dnQAAABh0RVh0VGh1bWI6OkRvY3VtZW50OjpQYWdlcwAx\n' +
            'p/+7LwAAABd0RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMjDf4aiZAAAAFnRFWHRUaHVtYjo6SW1h\n' +
            'Z2U6OldpZHRoADIwJ05oFAAAABp0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL2pwZWeLpZ60AAAA\n' +
            'F3RFWHRUaHVtYjo6TVRpbWUAMTYyNTQ3NjQzOUsw1dgAAAARdEVYdFRodW1iOjpTaXplADc3NUJC\n' +
            'l5HYRgAAAEV0RVh0VGh1bWI6OlVSSQBmaWxlOi8vL2FwcC90bXAvaW1hZ2VsYy9pbWd2aWV3Ml85\n' +
            'XzE2MjM5MTIxNTY1ODc3OTYzXzNfWzBdVKkjIQAAAABJRU5ErkJggg==" ></image>\n' +
            '</svg>\n';
        icons.dimensionalsymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">  <image id="image0" width="20" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAQAAAAngNWGAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN\n' +
            'RQflBwYBDhsIMi0IAAAAwElEQVQoz9WSPQrCQBBG30QRRTxBuhBIb2Fll9JC0nuLHMLaY9joCey1\n' +
            'tFMIwTa1jYXwWWziD4aQSnCmWZY3O2+HMdEuvJbcb0FLTLZsAWpLh5FFjaClVljEnKvOVR2CMSIW\n' +
            '+JwQBZEQJMjdC+GBdZlxAGDCkQEbpq61TKbds7XuVMoBuW5khKb3/HbMCaxPSPbBWelYmomYLnvE\n' +
            'haHzIkEsy7NqE5+FEHisXFk95v67pkf6nEHTi6QvEfvvNfuMBxvPeHX1PZMYAAAAJXRFWHRkYXRl\n' +
            'OmNyZWF0ZQAyMDIxLTA3LTA1VDE3OjE0OjI3KzA4OjAwQfzd5wAAACV0RVh0ZGF0ZTptb2RpZnkA\n' +
            'MjAyMS0wNy0wNVQxNzoxNDoyNyswODowMDChZVsAAAAgdEVYdHNvZnR3YXJlAGh0dHBzOi8vaW1h\n' +
            'Z2VtYWdpY2sub3JnvM8dnQAAABh0RVh0VGh1bWI6OkRvY3VtZW50OjpQYWdlcwAxp/+7LwAAABd0\n' +
            'RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMjDf4aiZAAAAFnRFWHRUaHVtYjo6SW1hZ2U6OldpZHRo\n' +
            'ADIwJ05oFAAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1i\n' +
            'OjpNVGltZQAxNjI1NDc2NDY30f8MmgAAABF0RVh0VGh1bWI6OlNpemUAMjAxQkLFr8dTAAAARnRF\n' +
            'WHRUaHVtYjo6VVJJAGZpbGU6Ly8vYXBwL3RtcC9pbWFnZWxjL2ltZ3ZpZXcyXzlfMTYyMzkxMjMx\n' +
            'NzgwMzY4ODJfMThfWzBdi6EngAAAAABJRU5ErkJggg==" ></image>\n' +
            '</svg>';
        icons.fractionsymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">  <image id="image0" width="20" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAAAAACo4kLRAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN\n' +
            'RQflBwYBDwMCRYQfAAAA+ElEQVQY012QMU7DQBBFx0AgQoggReIASCmpKFJwBjokxAU4AA0VJ+Aa\n' +
            'aRE1oiI9Eg01EpSWIZbttb229zGJF8Tma4vdv//P/BnBY36yO5qBW97llzx+bu4Pa2xAktBuJ/31\n' +
            'j4zvzo70UQbk9Hb+MaYKlVvf5lK6tUZPE3kY5dQBma9O6e1GLasgtBRYp1BlhUSiGMv+IJJIobWt\n' +
            'tjTsEBeYvLdrlYKyRpzT/CStQqgKYrAbr6dTa/1EGS6DjM3r9O1qQdkrSbVtZwaftHs+nrSGpVCz\n' +
            'Nc2wy/GR/O/7FwdOTf8nknMeb1gbc/gyuYhZhFtKqTrbL4kf41tX1IP2Z3cAAAAldEVYdGRhdGU6\n' +
            'Y3JlYXRlADIwMjEtMDctMDVUMTc6MTU6MDMrMDg6MDAYVJW3AAAAJXRFWHRkYXRlOm1vZGlmeQAy\n' +
            'MDIxLTA3LTA1VDE3OjE1OjAzKzA4OjAwaQktCwAAACB0RVh0c29mdHdhcmUAaHR0cHM6Ly9pbWFn\n' +
            'ZW1hZ2ljay5vcme8zx2dAAAAGHRFWHRUaHVtYjo6RG9jdW1lbnQ6OlBhZ2VzADGn/7svAAAAF3RF\n' +
            'WHRUaHVtYjo6SW1hZ2U6OkhlaWdodAAyMN/hqJkAAAAWdEVYdFRodW1iOjpJbWFnZTo6V2lkdGgA\n' +
            'MjAnTmgUAAAAGnRFWHRUaHVtYjo6TWltZXR5cGUAaW1hZ2UvanBlZ4ulnrQAAAAXdEVYdFRodW1i\n' +
            'OjpNVGltZQAxNjI1NDc2NTAzgQoFMgAAABF0RVh0VGh1bWI6OlNpemUAODA2QkKKUMl3AAAARnRF\n' +
            'WHRUaHVtYjo6VVJJAGZpbGU6Ly8vYXBwL3RtcC9pbWFnZWxjL2ltZ3ZpZXcyXzlfMTYyMzkxMjIy\n' +
            'ODAzMDIyNTdfMzVfWzBdI0ZUZgAAAABJRU5ErkJggg==" ></image>\n' +
            '</svg>';
        icons.standardsymbol =
            '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="21px" height="20px" viewBox="0 0 21 20" enable-background="new 0 0 21 20" xml:space="preserve">  <image id="image0" width="21" height="20" x="0" y="0"\n' +
            '    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAMAAABVlYYBAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\n' +
            'AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAOVBMVEX////bkDo6kNv/25A6\n' +
            'AAAAAABmtv+2kJDb////tmYAAGa2//86ADqQ2////9uQOgAAADq2ZgBmkJD8MFusAAAAAWJLR0QA\n' +
            'iAUdSAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAAd0SU1FB+UHBgEPHmFD6MYAAABDSURBVBjTY2AY\n' +
            'AMDIBKaYWVhZ2TBE2TkYOLm4GeAqWGGKmHl40dTy8QMlBdBFQbqR1UIASFQQphZuLsgEIQy1QwAA\n' +
            'ALGXAdquWSuVAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIxLTA3LTA1VDE3OjE1OjMwKzA4OjAwpzOI\n' +
            'yQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMS0wNy0wNVQxNzoxNTozMCswODowMNZuMHUAAAAgdEVY\n' +
            'dHNvZnR3YXJlAGh0dHBzOi8vaW1hZ2VtYWdpY2sub3JnvM8dnQAAABh0RVh0VGh1bWI6OkRvY3Vt\n' +
            'ZW50OjpQYWdlcwAxp/+7LwAAABd0RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMjDf4aiZAAAAFnRF\n' +
            'WHRUaHVtYjo6SW1hZ2U6OldpZHRoADIxUElYggAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdl\n' +
            'L3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxNjI1NDc2NTMwMy4HSwAAABF0RVh0VGh1bWI6\n' +
            'OlNpemUAMjc0QkJesz0BAAAARXRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vYXBwL3RtcC9pbWFnZWxj\n' +
            'L2ltZ3ZpZXcyXzlfMTYyMzkxMjIwNzYxNzk2NzFfNV9bMF3mj4UEAAAAAElFTkSuQmCC" ></image>\n' +
            '</svg>';
        icons.latexsymbol='<svg fill-opacity="1" xmlns:xlink="http://www.w3.org/1999/xlink" color-rendering="auto" color-interpolation="auto" text-rendering="auto" stroke="black" stroke-linecap="square" width="40" stroke-miterlimit="10" shape-rendering="auto" stroke-opacity="1" fill="black" stroke-dasharray="none" font-weight="normal" stroke-width="1" height="25" xmlns="http://www.w3.org/2000/svg" font-family="&apos;Dialog&apos;" font-style="normal" stroke-linejoin="miter" font-size="12" stroke-dashoffset="0" image-rendering="auto"\n' +
            '><!--Generated by the Batik Graphics2D SVG Generator--><defs id="genericDefs"\n' +
            '  /><g\n' +
            '  ><g fill="white" stroke="white"\n' +
            '    ><rect x="0" width="40" height="25" y="0" stroke="none"\n' +
            '    /></g\n' +
            '    ><g font-size="100" transform="scale(14,14) translate(0.2857,0.764) scale(0.007,0.007)" text-rendering="geometricPrecision" color-rendering="optimizeQuality" image-rendering="optimizeQuality" font-family="&apos;jlm_cmmi10&apos;" color-interpolation="linearRGB"\n' +
            '    ><path d="M37.4062 -60.5 L23.9062 -6.5 Q23.4062 -4.7031 23.4062 -4.2031 Q23.4062 -3.4062 24.2969 -3.2031 L24.2969 -3.2031 L24.2969 -3.2031 L24.7031 -3.2031 Q25.2969 -3.0938 26.9062 -3.0938 L36.2969 -3.0938 Q50.9062 -3.0938 57.5 -14.7031 Q59.2031 -17.7031 61.4062 -23.7031 Q62.2031 -25.5938 62.7031 -25.7031 L62.7969 -25.7969 L63.0938 -25.7969 Q64.2031 -25.7969 64.2969 -24.7031 Q64.2969 -24.4062 63.9062 -23.2969 L56 -1.7031 Q55.5 -0.2031 54.7031 -0.0938 L54.7031 -0.0938 L54.5938 -0.0938 Q54.2031 0 52.9062 0 L6.5938 0 Q4.0938 0 3.9062 -1.0938 Q3.9062 -2.9062 5.4062 -3.0938 L6.5938 -3.0938 Q13.0938 -3.0938 14.4062 -4.5 Q15 -5.2031 15.5938 -7.2969 Q15.5938 -7.4062 15.7031 -7.7969 L29.0938 -61.5 Q29.5 -63.0938 29.5 -63.4062 Q29.5 -64.5938 27.9062 -64.9062 L27.7969 -64.9062 L27.7031 -64.9062 Q27.4062 -64.9062 26.7969 -65 Q25.0938 -65.2031 23 -65.2031 Q20.4062 -65.2031 20.2031 -66.2969 Q20.2031 -68.2969 22.0938 -68.2969 L35.2969 -68 L35.4062 -68 L50.0938 -68.2969 L50.2031 -68.2969 Q51.7969 -68.2969 51.7969 -67.0938 Q51.7969 -65.5 50.5 -65.2969 Q49.9062 -65.2031 48 -65.2031 Q40.0938 -65.2031 38.5938 -63.5 Q38 -62.7969 37.4062 -60.5 Z" stroke="none"\n' +
            '    /></g\n' +
            '    ><g font-size="100" transform="matrix(14,0,0,14,0,0) translate(0.2857,1.4243) scale(0.007,0.007)" text-rendering="geometricPrecision" color-rendering="optimizeQuality" image-rendering="optimizeQuality" font-family="&apos;jlm_cmmi10&apos;" color-interpolation="linearRGB"\n' +
            '    ><path d="M37.2969 -37.7969 Q37.7969 -41.2031 40.4062 -42 Q40.9062 -42.2031 41.5 -42.2031 Q44.0938 -42.2031 44.4062 -39.5 Q44.4062 -38.9062 43.7031 -36.0938 L40.0938 -22.0938 Q38.5938 -15.7969 37.9062 -13.0938 Q36.5938 -7.9062 36.5938 -5.7031 Q36.5938 -1.0938 39.5938 -1.0938 Q43.4062 -1.0938 46 -9.0938 Q46.5 -10.7969 47.2031 -13.5 Q48 -15.2031 48.5938 -15.2969 Q49.7969 -15.2969 49.7969 -14.2969 Q49.7969 -12.7969 48 -7.2969 Q47.4062 -5.5938 46.7969 -4.4062 Q44 1.0938 39.4062 1.0938 Q33.7969 1.0938 31.2969 -3.7031 Q30.5938 -4.9062 30.2969 -6.4062 Q24 1.0938 17.2969 1.0938 Q9.7969 1.0938 6.2031 -5.7031 Q4 -9.7031 4 -14.9062 Q4 -25.7031 11.5 -34.9062 Q18.5 -43.2969 26.7031 -44.0938 Q27.4062 -44.2031 28.0938 -44.2031 Q34.2031 -44.2031 37.2969 -37.7969 ZM30.7969 -11.9062 L30.7969 -11.9062 L35.7969 -31.5 Q36.0938 -33 36.0938 -33.2031 Q36.0938 -35.2969 34.2969 -38.2969 Q32.0938 -42 28.2031 -42 Q23 -42 18.2969 -35.2031 Q17.4062 -33.9062 16.5938 -32.4062 Q13.7031 -26.5938 11.7031 -15.9062 Q11.0938 -12.5 11.0938 -10.5 Q11.0938 -3.7031 14.9062 -1.7031 Q16 -1.0938 17.5 -1.0938 Q23.0938 -1.0938 28.7969 -8.2031 Q30.2031 -9.7969 30.7031 -11.5 L30.7031 -11.5938 Q30.7969 -11.7969 30.7969 -11.9062 Z" stroke="none"\n' +
            '    /></g\n' +
            '    ><g font-size="100" transform="matrix(14,0,0,14,0,0) translate(0.7978,1.1771) scale(0.01,0.01)" text-rendering="geometricPrecision" color-rendering="optimizeQuality" image-rendering="optimizeQuality" font-family="&apos;jlm_cmmi10&apos;" color-interpolation="linearRGB"\n' +
            '    ><path d="M42.7031 -60.7031 L29.4062 -7.5938 Q29 -6.0938 29 -5.5 Q29 -4 30.5938 -3.5938 L30.7031 -3.5938 Q31.4062 -3.4062 32.7031 -3.2969 Q35.2969 -3.0938 39.0938 -3.0938 Q42.2031 -3.0938 42.4062 -2.5 Q42.5 -2.2969 42.5 -2 Q42.0938 -0.0938 40.2969 0 L31.7031 -0.2031 L31.5938 -0.2031 L23.5 -0.2969 L23.2969 -0.2969 L15 -0.2031 L14.7969 -0.2031 L6.7031 0 L6.5938 0 Q4.9062 0 4.9062 -1.2031 Q4.9062 -2.7031 6 -3 Q6.7031 -3.0938 9.0938 -3.0938 Q18 -3.0938 19.7031 -4.7969 Q20.2969 -5.4062 20.7031 -6.5938 Q20.7031 -6.7969 20.7969 -7.0938 L20.7969 -7.2969 L20.9062 -7.2969 L20.9062 -7.4062 Q20.9062 -7.5 21 -7.9062 L34.4062 -61.2969 Q34.7969 -62.5 34.7969 -63.3984 Q34.7969 -64.2969 33.9062 -64.5 Q33.2969 -64.5938 32 -64.5938 L28.0938 -64.5938 Q17.7969 -64.5938 14 -62.2969 Q11.9062 -61.0938 10.2969 -58.5938 L10.2031 -58.5 L10.2031 -58.4062 L10.0938 -58.4062 Q8 -55.0938 5.2969 -47.2969 Q4.5938 -45.4062 4.0938 -45.2969 Q3.9062 -45.2031 3.5938 -45.2031 Q2.4062 -45.2031 2.4062 -46.2969 Q2.4062 -46.9062 3 -48.0938 L9 -65.7031 Q9.5938 -67.4062 10.4062 -67.5938 Q10.9062 -67.7031 12.2031 -67.7031 L67.7031 -67.7031 Q70.2031 -67.7031 70.4062 -66.5938 Q70.4062 -65.7031 70.2031 -64.9062 L67.5 -47.5 Q67.2031 -45.4062 66 -45.2031 Q64.7969 -45.2031 64.7969 -46.5 Q64.7969 -47.2031 65.0938 -48.4062 Q65.9062 -53.5938 65.9062 -56.4062 Q65.9062 -62.2031 61.7969 -63.7031 Q59.2031 -64.5938 51.2969 -64.5938 Q45.9062 -64.5938 45 -64.4062 Q43.7031 -64.0938 43.0938 -62.2031 L43.0938 -62.0938 Q42.9062 -61.5938 42.7031 -60.7031 Z" stroke="none"\n' +
            '    /></g\n' +
            '    ><g font-size="100" transform="matrix(14,0,0,14,0,0) translate(1.5211,1.1771) scale(0.01,0.01)" text-rendering="geometricPrecision" color-rendering="optimizeQuality" image-rendering="optimizeQuality" font-family="&apos;jlm_cmmi10&apos;" color-interpolation="linearRGB"\n' +
            '    ><path d="M18.7031 -23.0938 L13.4062 -23.0938 Q11.7969 -16.5938 11.7969 -12.7031 Q11.7969 -4.7969 16.4062 -2.0938 Q18.0938 -1.0938 20.5 -1.0938 Q29.5 -1.0938 36.7031 -7.0938 Q38.7969 -8.7969 40.5 -11 Q41.2031 -12 41.7969 -12 Q42.7031 -12 43 -10.7031 Q43 -9.5938 39.5938 -6.4062 Q31.2969 1.0938 20.2969 1.0938 Q11.2969 1.0938 7.0938 -6.5938 Q4.5938 -11.0938 4.5938 -17 Q4.5938 -30.0938 14.7969 -38.2031 Q22.2969 -44.2031 30.7969 -44.2031 Q38 -44.2031 40.5938 -39.2031 Q41.5 -37.5938 41.5 -35.7031 Q41.5 -30.5 37 -27.0938 L36.9062 -27 Q35.5938 -26.0938 34 -25.4062 Q28.5 -23.0938 18.7031 -23.0938 ZM14 -25.2969 L18.0938 -25.2969 Q38.2031 -25.2969 38.2031 -35.7031 Q38.2031 -39.7031 34.2969 -41.4062 L34.2969 -41.4062 Q32.9062 -41.9062 30.7969 -42 Q25.2031 -42 20.5 -37.4062 Q16 -33 14 -25.2969 Z" stroke="none"\n' +
            '    /></g\n' +
            '    ><g font-size="100" transform="matrix(14,0,0,14,0,0) translate(1.9867,1.1771) scale(0.01,0.01)" text-rendering="geometricPrecision" color-rendering="optimizeQuality" image-rendering="optimizeQuality" font-family="&apos;jlm_cmmi10&apos;" color-interpolation="linearRGB"\n' +
            '    ><path d="M33.4062 -30.2031 L30 -16.5 Q28.2969 -9.7031 28.2969 -7.7031 Q28.2969 -2.5 32 -1.4062 Q32.7969 -1.0938 33.7969 -1.0938 Q38.7969 -1.0938 42.9062 -6.0938 Q45.5938 -9.2969 47.0938 -14.2031 Q47.4062 -15.2969 48.4062 -15.2969 Q49.5938 -15.2969 49.5938 -14.2969 Q49.5938 -11.7969 46.5 -7.0938 Q41.0938 1.0938 33.5938 1.0938 Q26.7969 1.0938 23.7031 -4.5938 Q23.0938 -5.5 22.7969 -6.5 Q20.4062 -1.7031 16.2031 0.2031 Q14.2969 1.0938 12.2969 1.0938 Q6.2969 1.0938 3.9062 -2.4062 Q2.9062 -3.7031 2.9062 -5.5 Q2.9062 -9.2031 6.0938 -10.7031 Q7.2031 -11.2969 8.4062 -11.2969 Q11.4062 -11.2969 12 -8.7969 Q12.0938 -8.2969 12.0938 -7.7969 Q12.0938 -4.4062 8.7031 -2.7969 Q8.0938 -2.5 7.4062 -2.4062 Q9.5 -1.0938 12.4062 -1.0938 Q17.7031 -1.0938 20.7969 -8.2031 Q21.4062 -9.7031 21.9062 -11.5 Q27.2969 -31.9062 27.2969 -35.2969 Q26.7031 -41.5 21.9062 -42 Q16.7031 -42 12.4062 -36.7031 L12.4062 -36.5938 Q12.4062 -36.5 12.2969 -36.5 Q10.7969 -34.5 9.5938 -31.9062 Q9.0938 -30.7031 8.7031 -29.5 L8.5 -28.9062 Q8.2969 -27.7969 7.2031 -27.7969 Q6 -27.7969 6 -28.7969 Q6 -31.2969 9.2031 -36 Q14.5938 -44.2031 22.0938 -44.2031 Q29.7969 -44.2031 32.9062 -36.5938 Q36.0938 -42.7969 41.4062 -44 Q42.4062 -44.2031 43.4062 -44.2031 Q49.2969 -44.2031 51.7031 -40.9062 Q52.7031 -39.5 52.7031 -37.5938 Q52.7031 -33.5 49 -32.0938 Q48.0938 -31.7969 47.2969 -31.7969 Q44.2031 -31.7969 43.5938 -34.5 Q43.5 -34.9062 43.5 -35.2969 Q43.5 -38.2969 46.4062 -40 Q47.2969 -40.5 48.2969 -40.7031 Q46.2031 -42 43.2969 -42 Q36.5 -42 33.7031 -31.4062 Q33.5 -30.7969 33.4062 -30.2031 Z" stroke="none"\n' +
            '    /></g\n' +
            '  ></g\n' +
            '></svg\n' +
            '>\n';
        //tinymce.IconManager.add('default', {icons: icons});
        for (var p in icons) {
            editor.ui.registry.addIcon(p, icons[p]);
        }
    }

    var register$1 = function (editor) {
        var symbols = [
            {
                id: 'fractionsymbol',
                cmdName: '分数',
                cmd: 'frac'
            }, {
                id: 'standardsymbol',
                cmdName: '尺寸标准公差',
                cmd: ''
            }, {
                id: 'markedsymbol',
                cmdName: '图符符号',
                cmd: ''
            }, {
                id: 'dimensionalsymbol',
                cmdName: '尺寸公差',
                cmd: ''
            }, {
                id: 'tolerancessymbol',
                dwidth: 940,
                dheight: 560,
                cmdName: '形位公差',
                cmd: ''
            }, {
                id: 'surfacenesssymbol',
                dwidth: 720,
                dheight: 580,
                cmdName: '表面粗糙度',
                cmd: ''
            },
            {
                id: 'latexsymbol',
                cmdName: 'LaTex',
                title:'LaTex公式',
                dheight: 460,
                cmd: ''
            }
        ];
        var symbolCfg = getProcessSymbalCfg(editor);
        var interValSplitter = symbolCfg.interValSplitter || '┇';
        var regSymbol = function (symbol) {
            editor.ui.registry.addMenuItem(symbol.id, {
                icon: symbol.id,
                text: symbol.title||symbol.cmdName,
                symbol: symbol,
                onAction: function () {
                    var cfg = {
                        title: symbol.title||symbol.cmdName,
                        width: symbol.dwidth || 500,
                        height: symbol.dheight || 300,
                        symbol: symbol,
                        page: symbol.id + '.html'
                    };
                    open(editor, cfg);
                }
            });
            editor.ui.registry.addContextMenu(symbol.id, {
                update: function (element) {
                    var tag = symbol.cmdName + interValSplitter;
                    return isSymbolImage(element, tag) ? [symbol.id] : [];
                }
            });
            editor.on('dblclick', function (e, t) {
                var element = e.target;
                var tag = symbol.cmdName + interValSplitter;
                if(element && isSymbolImage(element, tag)){
                    var cfg = {
                        title: symbol.title||symbol.cmdName,
                        width: symbol.dwidth || 500,
                        height: symbol.dheight || 300,
                        symbol: symbol,
                        page: symbol.id + '.html'
                    };
                    open(editor, cfg);
                }
            })
        }
        for (var i = 0; i < symbols.length; i++) {
            var symbol = symbols[i];
            regSymbol(symbol);
        }

    };

    function Plugin() {
        global.add('processsymbol', function (editor) {
            registerIcons(editor);
            register$1(editor);
        });
    }

    Plugin();
}());
